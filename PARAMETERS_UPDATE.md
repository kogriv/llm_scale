# Финальные параметры для Task 3 - более точная версия

## Изменения параметров (для большей точности при наличии запаса по времени)

### Предыдущие параметры (баланс скорость/точность):
- TAIL_STEPS = 3
- abundance_threshold = 500
- cap_normal = 100
- cap_on_transitions = 220
- finish_level на transitions = True
- finish_level обычно = False

### Новые параметры (акцент на точность):
- **TAIL_STEPS = 4** (было 3) - последние 4 шага без ограничений для максимальной точности
- **abundance_threshold = 400** (было 500) - раньше включаем адаптивную стратегию
- **cap_normal = 120** (было 100) - увеличили стандартный лимит
- **cap_on_transitions = 250** (было 220) - больше вариантов на переходах
- **finish_level ВСЕГДА = True** (было выборочно) - КРИТИЧНО: всегда досматриваем текущий уровень BFS

## Ключевое изменение: finish_level = True везде

Это самое важное изменение для корректности! Когда `finish_level=False` и cap небольшой, BFS может остановиться посреди уровня и не найти ближайшие цели. Это приводит к ситуации, когда `next_positions` оказывается пустым.

С `finish_level=True` везде:
- Гарантируется завершение текущего уровня BFS
- Не теряются близкие цели, находящиеся на том же расстоянии
- Корректность повышается при небольшом снижении скорости

## Проверка корректности

✅ Все примеры: 17, 17
✅ Все 12 workspace тестов совпадают с reference
✅ Добавлена защита от пустого next_positions (возврат -1)

## Оценка производительности

Ожидаемое замедление: ~15-25% по сравнению с агрессивной версией
- Связано с:
  - Более ранним включением адаптивной стратегии (threshold 400 vs 500)
  - Увеличенными cap (120/250 vs 100/220)
  - finish_level=True везде (досмотр уровней)
  - TAIL_STEPS=4 вместо 3

Но при этом:
- Корректность максимальная
- Все локальные тесты проходят
- Нет риска пропустить близкие оптимальные решения

## Рекомендация

Эта версия подходит для submission, если:
1. Запас по времени действительно есть (тесты показывали ~0.5-0.8s, лимит скорее всего 2s)
2. Предыдущие попытки давали WA (неправильный ответ), а не TLE
3. Важнее точность, чем скорость

Если получим TLE, можно откатиться к:
- TAIL_STEPS = 3
- abundance_threshold = 450-500
- cap_on_transitions = 220-230
